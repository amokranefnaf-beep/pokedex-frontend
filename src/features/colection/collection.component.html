<!--suppress ALL -->
<section class="collection-section">
  <div class="container">
    <!-- En-t√™te -->
    <div class="section-header">
      <div>
        <h2 class="section-title">MA COLLECTION</h2>
        @if (pokemons().length > 0) {
          <p class="collection-stats">
            Tu poss√®des
            <span class="highlight">{{ pokemons().length }}</span>
            cartes sur 1,025
          </p>
        }
      </div>

      <!-- Filtres -->
      <div class="filters">
        <button
          class="filter-btn"
          [class.active]="!selectedType() && !selectedRarity() && !favoriteOnly()"
          (click)="resetFilters()">
          Tous
        </button>

        <button
          class="filter-btn"
          [class.active]="favoriteOnly()"
          (click)="toggleFavoriteFilter()">
          ‚≠ê Favoris
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedType() === PokemonType.FIRE"
          (click)="filterByType(selectedType() === PokemonType.FIRE ? null : PokemonType.FIRE)">
          üî• Feu
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedType() === PokemonType.WATER"
          (click)="filterByType(selectedType() === PokemonType.WATER ? null : PokemonType.WATER)">
          üíß Eau
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedType() === PokemonType.GRASS"
          (click)="filterByType(selectedType() === PokemonType.GRASS ? null : PokemonType.GRASS)">
          üåø Plante
        </button>

        <button
          class="filter-btn"
          [class.active]="selectedType() === PokemonType.ELECTRIC"
          (click)="filterByType(selectedType() === PokemonType.ELECTRIC ? null : PokemonType.ELECTRIC)">
          ‚ö° √âlectrik
        </button>
      </div>
    </div>

    <!-- Barre de recherche -->
    <div class="search-bar">
      <input
        [value]="searchTerm()"
        class="search-input"
        placeholder="Rechercher par nom ou num√©ro..."
        type="text">

      @if (searchTerm()) {
        <button
          class="clear-search"
          (click)="updateSearch('')">
          ‚úï
        </button>
      }
    </div>

    <!-- √âtat de chargement -->
    @if (loading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement de ta collection...</p>
      </div>
    }

    <!-- √âtat d'erreur -->
    @else if (error()) {
      <div class="error-state">
        <p class="error-message">{{ error() }}</p>
        <button
          class="retry-btn"
          (click)="loadCollection()">
          R√©essayer
        </button>
      </div>
    }

    <!-- Collection vide -->
    @else if (pokemons().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Ta collection est vide</h3>
        <p>Commence par ajouter des Pok√©mon depuis la recherche !</p>
        <a routerLink="/search" class="cta-btn">
          üîç Rechercher des Pok√©mon
        </a>
      </div>
    }

    <!-- Grille de cartes -->
    @else {
      <!-- R√©sultats filtr√©s vides -->
      @if (filteredPokemons().length === 0) {
        <div class="no-results">
          <p>Aucun Pok√©mon ne correspond √† tes crit√®res</p>
          <button
            class="reset-btn"
            (click)="resetFilters()">
            R√©initialiser les filtres
          </button>
        </div>
      }

      @else {
        <div class="pokemon-grid">
          <!-- Utilisation de @for (Angular 20) avec track obligatoire -->
          @for (pokemon of paginatedPokemons(); track pokemon.id) {
            <div class="pokemon-card">
              <!-- Badge de raret√© -->
              @if (pokemon.rarity === Rarity.LEGENDARY) {
                <div class="rarity-badge legendary">
                  ‚òÖ L√âGENDAIRE
                </div>
              }
              @else if (pokemon.rarity === Rarity.RARE) {
                <div class="rarity-badge rare">
                  ‚òÖ RARE
                </div>
              }

              <!-- Bouton favori -->
              <button
                class="favorite-btn"
                [class.active]="pokemon.isFavorite"
                (click)="toggleFavorite(pokemon)"
                title="Marquer comme favori">
                ‚≠ê
              </button>

              <!-- Image du Pok√©mon -->
              <div class="pokemon-image-container">
                <img
                  [src]="pokemon.officialArtwork"
                  [alt]="pokemon.frenchName || pokemon.name"
                  class="pokemon-image"
                  loading="lazy">
              </div>

              <!-- Informations -->
              <div class="pokemon-info">
                <div class="pokemon-header">
                  <span class="pokemon-number">#{{ pokemon.id.toString().padStart(3, '0') }}</span>
                  <div class="pokemon-types">
                    @for (type of pokemon.types; track type) {
                      <span class="type-badge" [attr.data-type]="type">
                        {{ type }}
                      </span>
                    }
                  </div>
                </div>

                <h3 class="pokemon-name">
                  {{ pokemon.frenchName || pokemon.name | uppercase }}
                </h3>
              </div>

              <!-- Actions au survol -->
              <div class="pokemon-actions">
                <button
                  class="action-btn view"
                  title="Voir les d√©tails">
                  üëÅÔ∏è
                </button>
                <button
                  class="action-btn trade"
                  title="Proposer un √©change">
                  üîÑ
                </button>
                <button
                  class="action-btn remove"
                  (click)="removePokemon(pokemon)"
                  title="Retirer de la collection">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          }
        </div>

        <!-- Pagination -->
        @if (totalPages() > 1) {
          <div class="pagination">
            <button
              class="page-btn"
              [disabled]="currentPage() === 1"
              (click)="goToPage(currentPage() - 1)">
              ‚óÄ
            </button>

            @for (page of [].constructor(totalPages()); track $index) {
              <button
                class="page-btn"
                [class.active]="currentPage() === $index + 1"
                (click)="goToPage($index + 1)">
                {{ $index + 1 }}
              </button>
            }

            <button
              class="page-btn"
              [disabled]="currentPage() === totalPages()"
              (click)="goToPage(currentPage() + 1)">
              ‚ñ∂
            </button>
          </div>
        }
      }
    }
  </div>
</section>
